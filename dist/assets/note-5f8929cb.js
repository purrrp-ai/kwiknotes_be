import{g as se,b as ae,s as le,r as y,u as ce,_ as de,d as P,j as t,e as pe,f as ue,h as X,i as me,k as W,l as U,m as he,n as q,C as ge,o as z,a as m,p as xe,P as fe}from"./index-73886e4a.js";import{u as be}from"./useForkRef-f0f0758c.js";import{m as ye,B as Z}from"./makeStyles-8abd10b7.js";import{I as j}from"./IconButton-692d3f3e.js";import{C as F}from"./CircularProgress-e7129798.js";import{P as _e,a as je,c as Ce,A as Se,M as ve,b as we,C as Ne,I as ke}from"./header-f9be09ae.js";import{B as C}from"./Button-9730829b.js";import{c as H}from"./createSvgIcon-95652d7e.js";function Me(n){return se("MuiMasonry",n)}ae("MuiMasonry",["root"]);const Te=["children","className","component","columns","spacing","defaultColumns","defaultHeight","defaultSpacing"],S=n=>Number(n.replace("px","")),Pe={flexBasis:"100%",width:0,margin:0,padding:0},Be=n=>{const{classes:d}=n;return ue({root:["root"]},Me,d)},Re=({ownerState:n,theme:d})=>{let s={width:"100%",display:"flex",flexFlow:"column wrap",alignContent:"flex-start",boxSizing:"border-box","& > *":{boxSizing:"border-box"}};const r={};if(n.isSSR){const p={},i=S(d.spacing(n.defaultSpacing));for(let u=1;u<=n.defaultColumns;u+=1)p[`&:nth-of-type(${n.defaultColumns}n+${u%n.defaultColumns})`]={order:u};return r.height=n.defaultHeight,r.margin=-(i/2),r["& > *"]=P({},s["& > *"],p,{margin:i/2,width:`calc(${(100/n.defaultColumns).toFixed(2)}% - ${i}px)`}),P({},s,r)}const h=X({values:n.spacing,breakpoints:d.breakpoints.values}),a=me(d);s=W(s,U({theme:d},h,p=>{let i;if(typeof p=="string"&&!Number.isNaN(Number(p))||typeof p=="number"){const u=Number(p);i=q(a,u)}else i=p;return P({margin:`calc(0px - (${i} / 2))`,"& > *":{margin:`calc(${i} / 2)`}},n.maxColumnHeight&&{height:typeof i=="number"?Math.ceil(n.maxColumnHeight+S(i)):`calc(${n.maxColumnHeight}px + ${i})`})}));const x=X({values:n.columns,breakpoints:d.breakpoints.values});return s=W(s,U({theme:d},x,p=>{const u=`${(100/Number(p)).toFixed(2)}%`,v=typeof h=="string"&&!Number.isNaN(Number(h))||typeof h=="number"?q(a,Number(h)):"0px";return{"& > *":{width:`calc(${u} - ${v})`}}})),typeof h=="object"&&(s=W(s,U({theme:d},h,(p,i)=>{if(i){const u=Number(p),v=Object.keys(x).pop(),f=q(a,u);return{"& > *":{width:`calc(${`${(100/(typeof x=="object"?x[i]||x[v]:x)).toFixed(2)}%`} - ${f})`}}}return null}))),s},$e=le("div",{name:"MuiMasonry",slot:"Root",overridesResolver:(n,d)=>[d.root]})(Re),ze=y.forwardRef(function(d,s){const r=ce({props:d,name:"MuiMasonry"}),{children:h,className:a,component:c="div",columns:x=4,spacing:N=1,defaultColumns:p,defaultHeight:i,defaultSpacing:u}=r,v=de(r,Te),f=y.useRef(),[k,B]=y.useState(),R=!k&&i&&p!==void 0&&u!==void 0,[E,e]=y.useState(R?p-1:0),o=P({},r,{spacing:N,columns:x,maxColumnHeight:k,defaultColumns:p,defaultHeight:i,defaultSpacing:u,isSSR:R}),l=Be(o),g=_=>{if(!f.current||!_||_.length===0)return;const w=f.current,G=f.current.firstChild,Y=w.clientWidth,J=G.clientWidth;if(Y===0||J===0)return;const K=window.getComputedStyle(G),ne=S(K.marginLeft),oe=S(K.marginRight),A=Math.round(Y/(J+ne+oe)),I=new Array(A).fill(0);let $=!1;w.childNodes.forEach(M=>{if(M.nodeType!==Node.ELEMENT_NODE||M.dataset.class==="line-break"||$)return;const L=window.getComputedStyle(M),ie=S(L.marginTop),re=S(L.marginBottom),Q=S(L.height)?Math.ceil(S(L.height))+ie+re:0;if(Q===0){$=!0;return}for(let T=0;T<M.childNodes.length;T+=1){const O=M.childNodes[T];if(O.tagName==="IMG"&&O.clientHeight===0){$=!0;break}}if(!$){const T=I.indexOf(Math.min(...I));I[T]+=Q;const O=T+1;M.style.order=O}}),$||he.flushSync(()=>{B(Math.max(...I)),e(A>0?A-1:0)})},D=y.useRef(typeof ResizeObserver>"u"?void 0:new ResizeObserver(g));y.useEffect(()=>{const _=D.current;if(_!==void 0)return f.current&&f.current.childNodes.forEach(w=>{_.observe(w)}),()=>_?_.disconnect():{}},[x,N,h]);const V=be(s,f),te=new Array(E).fill("").map((_,w)=>t.jsx("span",{"data-class":"line-break",style:P({},Pe,{order:w+1})},w));return t.jsxs($e,P({as:c,className:pe(l.root,a),ref:V,ownerState:o},v,{children:[h,te]}))}),rt=ze,Fe=H([t.jsx("path",{d:"M16 9H8v10h8V9zm-.47 7.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12z",opacity:".3"},"0"),t.jsx("path",{d:"M14.12 10.47 12 12.59l-2.13-2.12-1.41 1.41L10.59 14l-2.12 2.12 1.41 1.41L12 15.41l2.12 2.12 1.41-1.41L13.41 14l2.12-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4zM6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9z"},"1")],"DeleteForeverTwoTone"),He=H(t.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),Ee=H(t.jsx("path",{d:"M7 7h10v1.79c0 .45.54.67.85.35l2.79-2.79c.2-.2.2-.51 0-.71l-2.79-2.79c-.31-.31-.85-.09-.85.36V5H6c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1s1-.45 1-1V7zm10 10H7v-1.79c0-.45-.54-.67-.85-.35l-2.79 2.79c-.2.2-.2.51 0 .71l2.79 2.79c.31.31.85.09.85-.36V19h11c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1s-1 .45-1 1v3z"}),"RepeatRounded"),Ve=H([t.jsx("path",{d:"M16 14h-2v4h-4v-4H8v5h8zm0 0V9H8v5l4-4z",opacity:".3"},"0"),t.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2-5V9h8v10H8v-5zm7.5-10-1-1h-5l-1 1H5v2h14V4zM10 18h4v-4h2l-4-4-4 4h2z"},"1")],"RestoreFromTrashTwoTone"),Ie=H(t.jsx("path",{d:"m20.55 5.22-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.15.55L3.46 5.22C3.17 5.57 3 6.01 3 6.5V19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.49-.17-.93-.45-1.28zM12 9.5l5.5 5.5H14v2h-4v-2H6.5L12 9.5zM5.12 5l.82-1h12l.93 1H5.12z"}),"Unarchive"),Le="_actual-note_18025_1",Oe="_toggle-container_18025_35",De="_note-attributes_18025_93",Ae="_note-title_18025_105",We="_note-content_18025_117",Ue="_note-toolie_18025_129",qe="_show-toolies_18025_163",Ge="_prompting-wrapper_18025_173",Ye="_extra-btns-wrapper_18025_175",Je="_button_18025_293",b={"actual-note":"_actual-note_18025_1",actualNote:Le,"toggle-container":"_toggle-container_18025_35",toggleContainer:Oe,"note-attributes":"_note-attributes_18025_93",noteAttributes:De,"note-title":"_note-title_18025_105",noteTitle:Ae,"note-content":"_note-content_18025_117",noteContent:We,"note-toolie":"_note-toolie_18025_129",noteToolie:Ue,"show-toolies":"_show-toolies_18025_163",showToolies:qe,"prompting-wrapper":"_prompting-wrapper_18025_173",promptingWrapper:Ge,"extra-btns-wrapper":"_extra-btns-wrapper_18025_175",extraBtnsWrapper:Ye,button:Je},Ke=ye({icnBtn:{"&":{fontSize:"1em !important",padding:"7px !important","& .MuiSvgIcon-root":{fontSize:"1.13em"}}}}),ee=({n})=>{var k,B,R,E;const d=Ke(),{setUser:s,setMessage:r,setShowSignIn:h}=y.useContext(ge),[a,c]=y.useState({binning:!1,deleting:!1,pinning:!1,restoring:!1,settingPrompt:!1,stashing:!1,triggerExtra:!1,triggerPrompt:!1}),x=new Date,N=x.toISOString().split("T")[0],p=x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),[i,u]=y.useState({date:N,time:p,repeatOption:"One time"}),v=[{icon:t.jsx(we,{}),clickFunc:()=>null,tooltip:"Partner"},{icon:t.jsx(Ne,{}),clickFunc:()=>null,tooltip:"Environment alternatives"},{icon:t.jsx(ke,{}),clickFunc:()=>null,tooltip:"Insert picture"}],f=(e,o)=>{c(l=>({...l,settingPrompt:!0})),z(e,o).then(l=>{s(g=>{const D=g.notes.map(V=>V._id===l._id?l:V);return{...g,notes:D}}),r({color:m.info,info:`Note ${l.binned?"binned":"restored"}.`})}).catch(({message:l})=>{l==="token expired"?(window.localStorage.removeItem("token"),s(null),h(!0),setTimeout(()=>r({color:m.warn,info:"Session expired. Please Sign in again."}),1e3)):r({color:m.error,info:l})}).finally(()=>c(l=>({...l,settingPrompt:!1})))};return t.jsxs("div",{tabIndex:0,className:b.actualNote,children:[!n.binned&&t.jsx("div",{className:b.toggleContainer,children:t.jsx(j,{className:d.icnBtn,color:"inherit","aria-label":n.pinned?"Unpin note":"Pin note",onClick:()=>{c(e=>({...e,pinning:!0})),z(n._id,{...n,pinned:!n.pinned}).then(e=>{s(o=>{const l=o.notes.map(g=>g._id===e._id?e:g);return{...o,notes:l}}),r({color:m.info,info:`Note ${e.pinned?"pinned":"unpinned"}.`})}).catch(({message:e})=>{e==="token expired"?(window.localStorage.removeItem("token"),s(null),h(!0),setTimeout(()=>r({color:m.warn,info:"Session expired. Please Sign in again."}),1e3)):r({color:m.error,info:e})}).finally(()=>c(e=>({...e,pinning:!1})))},children:a.pinning?t.jsx(F,{sx:{width:"18px !important",height:"18px !important"},color:"inherit"}):n.pinned?t.jsx(_e,{}):t.jsx(je,{})})}),t.jsxs("section",{className:b.noteAttributes,children:[n.title&&t.jsx("p",{className:b.noteTitle,children:n.title}),n.content&&t.jsx("p",{className:b.noteContent,children:n.content}),((k=n.prompt)==null?void 0:k.dueDate)&&t.jsxs(C,{sx:{padding:"4px 8px",borderRadius:9,display:"flex",flexFlow:"row nowrap",alignItems:"center",gap:.5,marginLeft:"auto"},color:"inherit",onClick:()=>c(e=>({...e,triggerPrompt:!0})),children:[new Date(n.prompt.dueDate).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),n.prompt.repeat!=="One time"&&t.jsx(Ee,{color:"inherit"})]})]}),t.jsx("div",{className:`${b.noteToolie} ${a.triggerExtra&&b.showToolies}`,children:n.binned?t.jsxs(t.Fragment,{children:[t.jsx(j,{color:"inherit","aria-label":"Delete note",onClick:()=>{c(e=>({...e,deleting:!0})),xe(n._id).then(({message:e})=>{s(o=>({...o,notes:o.notes.filter(l=>l._id!==n.id)})),r({color:m.info,info:e})}).catch(({message:e})=>r({color:m.error,info:e})).finally(()=>c(e=>({...e,deleting:!1})))},disabled:a.deleting,children:a.deleting?t.jsx(F,{color:"inherit",sx:{width:"18px !important",height:"18px !important"}}):t.jsx(Fe,{})}),t.jsx(j,{color:"inherit","aria-label":"Restore note",onClick:()=>{c(e=>({...e,restoring:!0})),z(n._id,{...n,binned:!n.binned}).then(e=>{s(o=>{const l=o.notes.map(g=>g._id===e._id?e:g);return{...o,notes:l}}),r({color:m.info,info:`Note ${e.binned?"binned":"restored"}.`})}).catch(({message:e})=>{e==="token expired"?(window.localStorage.removeItem("token"),s(null),h(!0),setTimeout(()=>r({color:m.warn,info:"Session expired. Please Sign in again."}),1e3)):r({color:m.error,info:e})}).finally(()=>c(e=>({...e,restoring:!1})))},disabled:a.restoring,children:t.jsx(Ve,{})})]}):t.jsxs(t.Fragment,{children:[v.map((e,o)=>t.jsx(j,{className:d.icnBtn,color:"inherit","aria-label":e.tooltip,onClick:e.clickFunc,children:e.icon},`${o}-${e.tooltip}`)),t.jsx(j,{className:d.icnBtn,color:"inherit",onClick:()=>{c(e=>({...e,stashing:!0})),z(n._id,{...n,stashed:!n.stashed}).then(e=>{s(o=>{const l=o.notes.map(g=>g._id===e._id?e:g);return{...o,notes:l}}),r({color:m.info,info:`Note ${e.stashed?"stashed":"unstashed"}.`})}).catch(({message:e})=>{e==="token expired"?(window.localStorage.removeItem("token"),s(null),h(!0),setTimeout(()=>r({color:m.warn,info:"Session expired. Please Sign in again."}),1e3)):r({color:m.error,info:e})}).finally(()=>c(e=>({...e,stashing:!1})))},"aria-label":a.stashing?"stashing note":n.stashed?"unstash note":"Stash note",disabled:a.stashing,children:a.stashing?t.jsx(F,{color:"inherit",sx:{width:"18px !important",height:"18px !important"}}):n.stashed?t.jsx(Ie,{}):t.jsx(Ce,{})}),t.jsxs("div",{style:{position:"relative"},children:[t.jsx(j,{className:d.icnBtn,color:"inherit","aria-label":"Set/Edit note prompt","aria-pressed":a.triggerPrompt,onClick:()=>c(e=>({...e,triggerPrompt:!0})),disabled:a.settingPrompt,children:a.settingPrompt?t.jsx(F,{color:"inherit",sx:{width:"18px !important",height:"18px !important"}}):t.jsx(Se,{})}),a.triggerPrompt&&t.jsxs(t.Fragment,{children:[t.jsx(Z,{sx:{background:"transparent"},open:a.triggerPrompt,onClick:()=>c(e=>({...e,triggerPrompt:!1}))}),t.jsxs("div",{className:b.promptingWrapper,children:[t.jsx("p",{children:"Select date and time"}),t.jsxs("form",{onSubmit:()=>f(n._id,{...n,prompt:{date:i.date,time:i.time,repeat:i.repeatOption}}),method:"post",children:[t.jsxs("div",{style:{position:"relative",display:"flex",flexFlow:"row nowrap",alignItems:"center",borderBottom:"1px solid rgba(0, 0, 0, 0.4)",marginTop:10,padding:"4px 2px"},children:[t.jsx("input",{type:"text",readOnly:!0,value:new Date(i.date).toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"}),style:{margin:0,padding:0,border:0}}),t.jsx("label",{htmlFor:"prompt-date",children:t.jsx(j,{sx:{width:24,height:24},color:"inherit",onClick:()=>{document.getElementById("date-picker").click()},children:t.jsx(He,{color:"inherit"})})}),t.jsx("input",{type:"date",name:"prompt-date",id:"prompt-date",min:N,onChange:({target:{value:e}})=>u(o=>({...o,date:e})),value:((B=n.prompt)==null?void 0:B.date)||i.date,placeholder:i.date.replace(/-/gu,"/"),style:{position:"absolute",top:10,left:0,opacity:0,border:0,margin:0,padding:0}})]}),t.jsx("input",{type:"time",name:"prompt-date",id:"prompt",min:p,onChange:({target:{value:e}})=>u(o=>({...o,time:e})),value:((R=n.prompt)==null?void 0:R.time)||i.time,placeholder:i.time}),t.jsx("select",{value:((E=n.prompt)==null?void 0:E.repeat)||i.repeatOption,onChange:({target:{value:e}})=>u(o=>({...o,repeatOption:e})),children:["One time","Daily","Weekly","Monthly","Yearly"].map((e,o)=>t.jsx("option",{value:e,children:e},`${e.replace(/[^\w]/gu,"")}${o}`))}),t.jsx(C,{sx:{m:"12px 0 0",textTransform:"none",fontFamily:"inherit"},color:"inherit",type:"submit",children:"Save"})]})]})]})]}),t.jsxs("div",{style:{position:"relative"},children:[t.jsx(j,{className:d.icnBtn,color:"inherit","aria-label":"Extra options","aria-pressed":a.triggerExtra,onClick:()=>c(e=>({...e,triggerExtra:!e.triggerExtra})),disabled:a.binning,children:a.binning?t.jsx(F,{sx:{width:"18px !important",height:"18px !important"},color:"inherit"}):t.jsx(ve,{})}),a.triggerExtra&&t.jsxs(t.Fragment,{children:[t.jsx(Z,{sx:{backgroundColor:"transparent"},open:a.triggerExtra,onClick:()=>c(e=>({...e,triggerExtra:!1}))}),t.jsxs("div",{className:b.extraBtnsWrapper,children:[t.jsx(C,{color:"inherit",onClick:()=>{c(e=>({...e,binning:!0})),z(n._id,{...n,binned:!n.binned}).then(e=>{s(o=>{const l=o.notes.map(g=>g._id===e._id?e:g);return{...o,notes:l}}),r({color:m.info,info:`Note ${e.binned?"binned":"restored"}.`})}).catch(({message:e})=>{e==="token expired"?(window.localStorage.removeItem("token"),s(null),h(!0),setTimeout(()=>r({color:m.warn,info:"Session expired. Please Sign in again."}),1e3)):r({color:m.error,info:e})}).finally(()=>c(e=>({...e,binning:!1})))},children:"Bin note"}),t.jsx(C,{color:"inherit",children:"Add tag"}),t.jsx(C,{color:"inherit",children:"Add scribble"}),t.jsx(C,{color:"inherit",children:"Duplicate"}),t.jsx(C,{color:"inherit",children:"Show checkboxes"}),t.jsx(C,{color:"inherit",children:"Copy to Cloud"})]})]})]})]})})]})};ee.propTypes={n:fe.object.isRequired};const st=ee;export{rt as M,st as N};
