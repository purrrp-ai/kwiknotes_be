import{r as m,C as j,j as o,y as B,z as C,a as h}from"./index-73886e4a.js";import{L as M}from"./logo-link-04dba84f.js";import{M as y}from"./Modal-96cf205e.js";import{F as N,V as k,a as F}from"./FormGroup-2d100d0c.js";import{F as u,T as x,a as f}from"./TextField-890f9e1c.js";import{I as A}from"./IconButton-692d3f3e.js";import{C as P}from"./CircularProgress-e7129798.js";import{B as v}from"./Button-9730829b.js";import{S as z}from"./Login-8e6dfb92.js";import{m as E}from"./makeStyles-8abd10b7.js";import"./useForkRef-f0f0758c.js";import"./createSvgIcon-95652d7e.js";import"./useIsFocusVisible-a21fe620.js";const W="_form-wrapper_14c08_1",$="_hide-wrapper_14c08_25",U="_top-section_14c08_33",Z="_sign-in-method-toggle_14c08_67",L="_sign-up-text_14c08_99",O="_switch-btn_14c08_119",i={"form-wrapper":"_form-wrapper_14c08_1",formWrapper:W,"hide-wrapper":"_hide-wrapper_14c08_25",hideWrapper:$,"top-section":"_top-section_14c08_33",topSection:U,"sign-in-method-toggle":"_sign-in-method-toggle_14c08_67",signInMethodToggle:Z,"sign-up-text":"_sign-up-text_14c08_99",signUpText:L,"switch-btn":"_switch-btn_14c08_119",switchBtn:O},D=E({base:{"&":{"& .MuiTextField-root":{"& .MuiFormLabel-root":{font:"inherit",color:"hsla(210, 20%, 20%, 0.75)",pointerEvents:"none",userSelect:"none"},"& .MuiInputBase-root":{font:"inherit",color:"inherit",marginBottom:"1em","&::before":{borderBottomColor:"hsla(205, 19.6%, 19%, 0.3)"},"&:hover::before":{borderBottom:"1px solid hsla(205, 19.6%, 19%, 0.6)"},"&::after":{borderBottom:"1px solid var(--deep-blue)"}},"& .MuiButtonBase-root":{color:"hsla(205, 19.6%, 19%, 0.75)","&:hover, &:focus":{color:"var(--deep-blue)"}}}},"& .MuiFormHelperText-root":{all:"unset",position:"absolute",width:"fit-content",right:0,color:"#f44336",bottom:"1.75em",fontSize:"0.75em",lineHeight:"1.5em",pointerEvents:"none",userSelect:"none"}},passwordBase:{"&":{"& .MuiFormHelperText-root":{bottom:"1.25em"}}},signInBtn:{"&":{fontSize:"1em !important",fontFamily:"inherit !important",padding:"8px !important",color:"inherit !important",borderColor:"hsla(205, 19.6%, 19%, 0.4) !important","&:hover":{backgroundColor:"hsla(205, 19.6%, 19%, 0.05) !important",borderColor:"hsla(205, 19.6%, 19%, 0.6) !important"}}},signingInSpinner:{"&":{color:"hsl(210, 20%, 20%) !important",margin:"3px auto"}},modal:{"&":{display:"grid",placeItems:"center","& .MuiBackdrop-root":{backgroundColor:"rgba(0, 0, 0, 0)"}}}});function ne(){const a=D(),{setUser:w,showSignIn:c,setShowSignIn:p,setMessage:d,setShowSignUp:S}=m.useContext(j),[n,s]=m.useState({emailSignIn:!1,username:"",email:"",HelperText:"",password:"",passwordHelperText:"",showPassword:!1,signingIn:!1}),[I,l]=m.useState(!1);setTimeout(c?()=>l(!0):()=>l(!1),150);const _=()=>{n.emailSignIn?s(r=>({...r,username:"",HelperText:""})):s(r=>({...r,email:"",HelperText:""})),s(r=>({...r,emailSignIn:!r.emailSignIn}))},T=r=>{s(e=>({...e,signingIn:!0})),r.preventDefault(),B({usernameOrEmail:n.username||n.email,password:n.password}).then(({email:e,token:t,username:g})=>{w({email:e,username:g}),s(H=>({...H,emailSignIn:!1,username:"",email:"",HelperText:"",password:"",passwordHelperText:""})),window.localStorage.setItem("token",JSON.stringify({accessToken:t}));const b=JSON.parse(window.localStorage.getItem("token"));C(b.accessToken),p(!1),d({color:h.success,info:`Signed in as ${g}`})}).catch(({message:e})=>{/Sorry/.test(e)?s(t=>({...t,HelperText:e})):/Wrong/.test(e)?s(t=>({...t,passwordHelperText:e})):d({color:h.error,info:e})}).finally(()=>{s(e=>({...e,signingIn:!1})),setTimeout(()=>{s(e=>({...e,HelperText:"",passwordHelperText:""}))},4e3)})};return o.jsx(y,{open:c,onClose:()=>{l(!1),setTimeout(()=>p(!1),150)},className:a.modal,children:o.jsxs("div",{className:`${i.formWrapper} ${!I&&i.hideWrapper}`,children:[o.jsx("div",{className:i.topSection,children:o.jsx(M,{w:1.75})}),o.jsx("form",{className:i.signInForm,method:"post",onSubmit:T,children:o.jsxs(N,{children:[o.jsxs(u,{className:a.base,children:[o.jsx(x,{type:n.emailSignIn?"email":"text",name:n.emailSignIn?"email":"username",id:n.emailSignIn?"email":"username",value:n.emailSignIn?n.email:n.username,variant:"standard",label:n.emailSignIn?"EMAIL":"USERNAME",onChange:({target:{name:r,value:e}})=>{r=="email"?(s(t=>({...t,email:e})),e?/^(?=[a-zA-Z0-9._%+-]{1,64}@([a-zA-Z0-9.-]{1,253}\.){1,5}[a-zA-Z]{2,63}$)[a-zA-Z0-9._%+-]{1,64}@([a-zA-Z0-9.-]{1,253}\.){1,5}[a-zA-Z]{2,63}$/.test(e)?s(t=>({...t,HelperText:null})):s(t=>({...t,HelperText:"invalid email format"})):s(t=>({...t,HelperText:null}))):r=="username"?(s(t=>({...t,username:e})),s(e?t=>({...t,HelperText:null}):t=>({...t,HelperText:null}))):s(t=>({...t,HelperText:null}))}}),o.jsx(f,{children:n.HelperText}),o.jsxs("button",{className:i.signInMethodToggle,type:"button",onClick:()=>_(),children:["Sign In with ",n.emailSignIn?"username":"email"]})]}),o.jsxs(u,{className:`${a.base} ${a.passwordBase}`,children:[o.jsx(x,{id:"password",name:"password",type:n.showPassword?"text":"password",onChange:({target:{value:r}})=>{s(e=>({...e,password:r})),s(r?e=>({...e,passwordHelperText:null}):e=>({...e,passwordHelperText:null}))},value:n.password,variant:"standard",label:"PASSWORD",onBlur:()=>{n.showPassword&&s(r=>({...r,showPassword:!1}))},InputProps:{endAdornment:o.jsx(A,{onClick:()=>s(r=>({...r,showPassword:!r.showPassword})),children:n.showPassword?o.jsx(k,{}):o.jsx(F,{})})},sx:{mb:2}}),n.passwordHelperText&&o.jsx(f,{error:!0,children:n.passwordHelperText})]}),n.signingIn?o.jsx(P,{className:a.signingInSpinner}):o.jsx(v,{variant:"outlined",className:a.signInBtn,id:"sign-in__btn",type:"submit",startIcon:o.jsx(z,{}),children:"Sign In"})]})}),o.jsxs("p",{className:i.signUpText,children:["New to ",o.jsx("a",{href:"/",children:"Kwik Notes"}),"?"," ",o.jsx("button",{type:"button",onClick:()=>{l(!1),setTimeout(()=>{p(!1),S(!0)},150)},className:i.switchBtn,children:"Sign up"})]})]})})}export{ne as default};
